<script src="https://use.typekit.net/previewkits/pk-v1.js?t"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.0/gsap.min.js"></script>

<style>
  @font-face{font-family:omnes-pro;src:url(https://use.typekit.net/af/fab690/000000000000000077359bed/30/l?subset_id=2&fvd=n5&v=3) format("woff2"),url(https://use.typekit.net/af/fab690/000000000000000077359bed/30/d?subset_id=2&fvd=n5&v=3) format("woff"),url(https://use.typekit.net/af/fab690/000000000000000077359bed/30/a?subset_id=2&fvd=n5&v=3) format("opentype");font-weight:500;font-style:normal;font-stretch:normal;font-display:auto;}@font-face{font-family:omnes-pro;src:url(https://use.typekit.net/af/b6e4b0/000000000000000077359c3e/30/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/b6e4b0/000000000000000077359c3e/30/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/b6e4b0/000000000000000077359c3e/30/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;font-stretch:normal;font-display:auto;}@font-face{font-family:omnes-pro;src:url(https://use.typekit.net/af/b7f08e/000000000000000077359bea/30/l?subset_id=2&fvd=n8&v=3) format("woff2"),url(https://use.typekit.net/af/b7f08e/000000000000000077359bea/30/d?subset_id=2&fvd=n8&v=3) format("woff"),url(https://use.typekit.net/af/b7f08e/000000000000000077359bea/30/a?subset_id=2&fvd=n8&v=3) format("opentype");font-weight:800;font-style:normal;font-stretch:normal;font-display:auto;}@font-face{font-family:omnes-pro;src:url(https://use.typekit.net/af/6c518c/000000000000000077359be7/30/l?subset_id=2&fvd=i5&v=3) format("woff2"),url(https://use.typekit.net/af/6c518c/000000000000000077359be7/30/d?subset_id=2&fvd=i5&v=3) format("woff"),url(https://use.typekit.net/af/6c518c/000000000000000077359be7/30/a?subset_id=2&fvd=i5&v=3) format("opentype");font-weight:500;font-style:italic;font-stretch:normal;font-display:auto;}@font-face{font-family:omnes-pro;src:url(https://use.typekit.net/af/228d07/000000000000000077359c44/30/l?subset_id=2&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/228d07/000000000000000077359c44/30/d?subset_id=2&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/228d07/000000000000000077359c44/30/a?subset_id=2&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;font-stretch:normal;font-display:auto;}@font-face{font-family:omnes-pro;src:url(https://use.typekit.net/af/cf55ca/000000000000000077359bee/30/l?subset_id=2&fvd=i8&v=3) format("woff2"),url(https://use.typekit.net/af/cf55ca/000000000000000077359bee/30/d?subset_id=2&fvd=i8&v=3) format("woff"),url(https://use.typekit.net/af/cf55ca/000000000000000077359bee/30/a?subset_id=2&fvd=i8&v=3) format("opentype");font-weight:800;font-style:italic;font-stretch:normal;font-display:auto;}

  .slider__container {
    position: relative;
    height: 300px;
    width: 100%;
    max-width: 1024px;
    margin-left: auto;
    margin-right: auto;
  }

  .slider {
    position: absolute;
    top: 50%;
    left: 15%;
    width: 70%;
    height: 50px;
    z-index: 20;
    transform: translateY(-50%);
    font-family: omnes-pro;
    font-weight: 500;
  }

  .slider__thumb {
    position: absolute;
    top: -28px;
    left: -43px;
    width: 100px;
    height: 100px;
    cursor: pointer;
    z-index: 3;
  }

  .slider__thumb img {
    width: 100%;
    pointer-events: none;
  }

  .slider__thumb div {
    position: absolute;
    top: -70px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    opacity: 0;
    transition: opacity 0.2s linear;
    color: #ec2b8f;
    font-size: 30px;
    font-weight: 800;
    line-height: 1;
  }

  .slider__track-text {
    z-index: 2;
    clip-path: polygon(100% 0%, 100% 0, 100% 100%, 100% 100%);
    font-size: 24px;
    position: absolute;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
  }

  .slider__track-right .slider__track-text {
    justify-content: flex-end;
  }

  .slider__track-left div:nth-child(1) {
    left: 25px;
  }

  .slider__track-right div:nth-child(1) {
    right: 25px;
  }
  
  .slider__thumb div.active {
    transition: opacity 0.2s linear 0.2s;
    opacity: 1;
  }

  .slider__track {
    width: 100%;
    height: 100%;
    border-radius: 50px;
    overflow: hidden;
    position: relative;
  }

  .slider__track-left {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50px;
    overflow: hidden;
    -webkit-mask-image: -webkit-radial-gradient(circle, white 100%, black 100%);
  }
  
  .slider__track-right {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50px;
    overflow: hidden;
    -webkit-mask-image: -webkit-radial-gradient(circle, white 100%, black 100%);
  }
  
  .slider__track-left-inner {
    background-color: #ffce03;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50px;
  }
  
  .slider__track-right-inner {
    background-color: #67d669;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50px;
  }

  .slider__texts {
    position: relative;
    max-width: 80%;
    margin-left: auto;
    margin-right: auto;
  }

  .slider__text {
    text-align: center;
    position: absolute;
    top: 40px; 
    left: 0;
    width: 100%;
    opacity: 0;
    transition: opacity 0.2s linear;
    font-size: 24px;
  }

  .slider__text.active {
    transition: opacity 0.2s linear 0.2s;
    opacity: 1;
  }

  @media (max-width: 768px) {

    .slider__container {
      height: 270px;
    }

    .slider {
      width: 100%;
      left: 0;
    }

    .slider__track-text {
      font-size: 18px;
    }

    .slider__thumb div {
      font-size: 20px;
      top: -50px;
    }
  }

</style>

<div class="slider__container">
  <div class="slider">
    <div class="slider__thumb">
      <img src="./kyl-logo.png" alt="Know Your Lemons Logo">
      <div>earlier diagnosis</div>
      <div>later diagnosis</div>
    </div>
    <div class="slider__track">
      <div class="slider__track-left">
        <div class="slider__track-text">
          <div>education</div>
        </div>
        <div class="slider__track-left-inner"></div>
      </div>
      <div class="slider__track-right">
        <div class="slider__track-text">
          <div>treatment</div>
        </div>
        <div class="slider__track-right-inner"></div>
      </div>
    </div>
    <div class="slider__texts">
      <div class="slider__text">more treatment needed, less survival</div>
      <div class="slider__text">two ways to save lives from breast cancer</div>
      <div class="slider__text">less treatment needed, better survival</div>
    </div>
  </div>
</div>

<script>
  function Slider() {
    var sliderContainer = document.querySelector('.slider__container');
    var slider = sliderContainer.querySelector('.slider');
    var thumb = slider.querySelector('.slider__thumb');
    var thumbImage = slider.querySelector('.slider__thumb img');
    var texts = slider.querySelectorAll('.slider__text');
    var thumbDivs = slider.querySelectorAll('.slider__thumb div');
    var left = slider.querySelector('.slider__track-left-inner');
    var right = slider.querySelector('.slider__track-right-inner');

    var leftTrack = slider.querySelector('.slider__track-left div');
    var rightTrack = slider.querySelector('.slider__track-right div');

    var sliderWidth;
    var thumbWidth;
    var containerWidth;
    var currentX = 0;
    var initialX;
    var leftWidth;
    var xOffset;
    var screen;
    var active;
    var animate;
    var tm;
    var focus = 0.5;

    function init() {
      resizeHandler();
      events();
      reset();

      const halfSliderWidth = sliderWidth * 0.5;

      tm = gsap.timeline({
        repeat: -1,
        yoyo: true
      });

      tm.pause();
      tm.to(thumb, { x: halfSliderWidth - 20, z: 1, duration: 1.5, ease: 'power2.inOut' });
      tm.to([left, right], { x: '-=20', duration: 1.5, ease: 'power2.inOut' }, '-=1.5');
      tm.to(thumb, { x: halfSliderWidth + 20, z: 1, duration: 1.5, ease: 'power2.inOut' });
      tm.to([left, right], { x: '+=40', duration: 1.5, ease: 'power2.inOut' }, '-=1.5');
      tm.play();
    }

    function events() {
      window.addEventListener('resize', resizeHandler);
      
      sliderContainer.addEventListener('touchstart', dragStartHandler);
      sliderContainer.addEventListener('touchend', dragEndHandler);
      sliderContainer.addEventListener('touchmove', dragHandler);

      sliderContainer.addEventListener('mousedown', dragStartHandler);
      sliderContainer.addEventListener('mouseup', dragEndHandler);
      sliderContainer.addEventListener('mousemove', dragHandler);
      
      document.addEventListener('mouseleave', dragEndHandler);
    }

    function resizeHandler() {
      screen = {
        width: window.innerWidth, 
        height: window.innerHeight
      };

      sliderWidth = slider.clientWidth;
      thumbWidth = thumb.clientWidth;
      leftWidth = left.clientWidth;
      containerWidth = sliderContainer.clientWidth;
      
      move();
    }

    function reset() {
      xOffset = sliderWidth * focus;
      currentX = xOffset;
      
      move();
    }

    function dragStartHandler(e) {
      tm.pause();
      gsap.to(thumbImage, { x: '0%', duration: 1, ease: 'power2.inOut' });

      initialX = e.type === 'touchstart' ? e.touches[0].clientX - xOffset : e.clientX - xOffset;

      if (e.target === thumb) {
        active = true;
      }
    }

    function dragEndHandler(e) {
      initialX = currentX;
      active = false;
      direction = null;

      slider.classList.remove('dragging-left', 'dragging-right');
    }

    function dragHandler(e) {
      if (active) {
        e.preventDefault();
        
        var _currentX = e.type === 'touchmove' ? e.touches[0].clientX - initialX : e.clientX - initialX;

        var direction;
        if (currentX > _currentX) direction = 'left';
        if (currentX < _currentX) direction = 'right';

        if (direction !== direction) {
          direction = direction;
          
          if (direction === 'left') {
            slider.classList.remove('dragging-right');
          } else if (direction === 'right') {
            slider.classList.remove('dragging-left');
          }

          slider.classList.add(`dragging-${direction}`);
        }

        currentX = _currentX;
        xOffset = currentX;
        
        move();
      }
    }

    function move(disableThumb) {
      var x = Math.min(Math.max(currentX, sliderWidth * 0.2), sliderWidth * 0.8);
      var percent = x / sliderWidth;
      
      if (!disableThumb) {
        thumb.style.transform = 'translateX(' + x + 'px)';
      }
      left.style.transform = 'translateX(' + (x - 32 - sliderWidth) + 'px)';
      right.style.transform = 'translateX(' + (x + 40) + 'px)';
      
      var rightMaskX = (1 - (sliderWidth - x) / sliderWidth + 0.1) * sliderWidth;
      rightTrack.style.clipPath = 'polygon(' + rightMaskX + 'px 0%, 100% 0, 100% 100%, ' + rightMaskX + 'px 100%)';
      
      var leftMaskX = sliderWidth - sliderWidth * (1 - percent + 0.05);
      leftTrack.style.clipPath = 'polygon(0% 0%, ' + leftMaskX + 'px 0, ' + leftMaskX + 'px 100%, 0% 100%)';

      if (percent < 0.4) {
        texts[0].classList.add('active');
        texts[1].classList.remove('active');
        texts[2].classList.remove('active');
        thumbDivs[0].classList.remove('active');
        thumbDivs[1].classList.add('active');
      } else if (percent > 0.6) {
        texts[0].classList.remove('active');
        texts[2].classList.add('active');
        texts[1].classList.remove('active');
        thumbDivs[0].classList.add('active');
        thumbDivs[1].classList.remove('active');
      } else {
        texts[0].classList.remove('active');
        texts[1].classList.add('active');
        texts[2].classList.remove('active');
        thumbDivs[0].classList.remove('active');
        thumbDivs[1].classList.remove('active');
      }
    }

    init();
  }

  new Slider();
</script>